# **7. Database Migrations & Seeders**  

## **1. What are Migrations?**  
Migrations in Laravel act as a version control system for databases, allowing developers to manage database schema changes in a structured and trackable way.

### **Creating a Migration**
```sh
php artisan make:migration create_posts_table
```
This generates a migration file in `database/migrations/`.

### **Structure of a Migration File**
A typical migration file looks like this:
```php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration {
    public function up()
    {
        Schema::create('posts', function (Blueprint $table) {
            $table->id();
            $table->string('title');
            $table->text('content');
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->timestamps();
        });
    }

    public function down()
    {
        Schema::dropIfExists('posts');
    }
};
```
- `up()` defines how to create the table.  
- `down()` defines how to rollback (delete) the table.

### **Running Migrations**
```sh
php artisan migrate
```
- Runs all pending migrations.

### **Rolling Back Migrations**
```sh
php artisan migrate:rollback
```
- Rolls back the last batch of migrations.

```sh
php artisan migrate:reset
```
- Rolls back all migrations.

```sh
php artisan migrate:refresh
```
- Rolls back and re-runs all migrations.

```sh
php artisan migrate:fresh
```
- Drops all tables and re-runs migrations.

---

## **2. Modifying Existing Tables**
To modify an existing table, use:
```sh
php artisan make:migration add_status_to_posts --table=posts
```
In the generated file:
```php
public function up()
{
    Schema::table('posts', function (Blueprint $table) {
        $table->string('status')->default('draft');
    });
}

public function down()
{
    Schema::table('posts', function (Blueprint $table) {
        $table->dropColumn('status');
    });
}
```
Run the migration:
```sh
php artisan migrate
```

---

## **3. Database Seeders**  
Seeders populate the database with sample data.

### **Creating a Seeder**
```sh
php artisan make:seeder UserSeeder
```
Generated file: `database/seeders/UserSeeder.php`
```php
use Illuminate\Database\Seeder;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class UserSeeder extends Seeder
{
    public function run()
    {
        User::create([
            'name' => 'Admin',
            'email' => 'admin@example.com',
            'password' => Hash::make('password'),
        ]);
    }
}
```

### **Running a Seeder**
```sh
php artisan db:seed --class=UserSeeder
```
Or run all seeders:
```sh
php artisan db:seed
```

---

## **4. Factory-Based Seeding**  
Factories allow generating dummy data using Faker.

### **Creating a Factory**
```sh
php artisan make:factory UserFactory --model=User
```
Generated file: `database/factories/UserFactory.php`
```php
use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;

class UserFactory extends Factory
{
    protected $model = User::class;

    public function definition()
    {
        return [
            'name' => $this->faker->name,
            'email' => $this->faker->unique()->safeEmail,
            'password' => Hash::make('password'),
        ];
    }
}
```

### **Using a Factory in a Seeder**
Modify `UserSeeder.php`:
```php
User::factory()->count(10)->create();
```

### **Running Factories with Seeders**
```sh
php artisan db:seed
```

### **Using Factories in Tinker**
```sh
php artisan tinker
```
Inside Tinker:
```php
App\Models\User::factory()->count(5)->create();
```

---

## **5. Database Transactions in Seeders**
To prevent partial database insertions, use:
```php
use Illuminate\Support\Facades\DB;

DB::transaction(function () {
    User::factory()->count(50)->create();
});
```

---

## **6. Populating Test Data in Tests**
```php
public function test_user_creation()
{
    $user = User::factory()->create();
    $this->assertDatabaseHas('users', ['email' => $user->email]);
}
```

---

## **7. Running Migrations & Seeders Together**
```sh
php artisan migrate --seed
```
or
```sh
php artisan migrate:fresh --seed
```

---

## **8. Key Interview Questions on Migrations & Seeders**
1. What are **migrations** in Laravel, and why are they useful?  
2. How do you modify an **existing table** using migrations?  
3. What is the difference between **rollback, reset, refresh, and fresh** in migrations?  
4. How do you seed a database using Laravel **seeders and factories**?  
5. What is the role of **factories** in database seeding?  
6. How can you use **transactions** in database seeding to avoid partial inserts?  
7. How do you **populate test data** using factories in Laravel tests?  
8. What is the advantage of using **database migrations over raw SQL**?  

---
