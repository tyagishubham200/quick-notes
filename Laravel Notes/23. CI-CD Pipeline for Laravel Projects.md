# **23. CI/CD Pipeline for Laravel Projects**

A Continuous Integration and Continuous Deployment (CI/CD) pipeline automates testing, building, and deploying Laravel applications. This ensures a smooth and error-free development lifecycle.

---

## **1. Why Use CI/CD in Laravel?**
✅ Automates testing to prevent breaking changes.  
✅ Ensures consistent deployment workflows.  
✅ Reduces human errors in production releases.  
✅ Speeds up the release process.

---

## **2. Setting Up CI/CD for Laravel**

### **A. Choosing a CI/CD Tool**
Popular tools include:
- **GitHub Actions** (Built-in for GitHub repositories)
- **GitLab CI/CD**
- **Bitbucket Pipelines**
- **Jenkins**
- **CircleCI**

---

## **3. CI/CD Pipeline with GitHub Actions**

### ✅ **Step 1: Create a GitHub Actions Workflow**
Create `.github/workflows/laravel-ci.yml` in your project repository.

```yaml
name: Laravel CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  laravel-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set Up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
          extensions: mbstring, xml, ctype, iconv, pdo, bcmath

      - name: Install Dependencies
        run: composer install --prefer-dist --no-progress --no-suggest

      - name: Set Up Environment
        run: cp .env.example .env

      - name: Generate Application Key
        run: php artisan key:generate

      - name: Run Migrations
        run: php artisan migrate --force

      - name: Run Tests
        run: php artisan test

  deploy:
    needs: laravel-tests
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to Server
        uses: appleboy/ssh-action@v0.1.6
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /var/www/html
            git pull origin main
            composer install --no-dev --optimize-autoloader
            php artisan migrate --force
            php artisan config:cache
            php artisan route:cache
```

---

## **4. Deployment Using GitLab CI/CD**

### ✅ **Step 1: Create a `.gitlab-ci.yml` File**

```yaml
stages:
  - test
  - deploy

test:
  stage: test
  image: php:8.2
  script:
    - apt-get update && apt-get install -y unzip git
    - curl -sS https://getcomposer.org/installer | php
    - mv composer.phar /usr/local/bin/composer
    - composer install --prefer-dist --no-progress --no-suggest
    - cp .env.example .env
    - php artisan key:generate
    - php artisan migrate --force
    - php artisan test

deploy:
  stage: deploy
  script:
    - ssh $SSH_USER@$SSH_HOST 'cd /var/www/html && git pull origin main && composer install --no-dev --optimize-autoloader && php artisan migrate --force && php artisan config:cache && php artisan route:cache'
  only:
    - main
```

---

## **5. Using Jenkins for Laravel CI/CD**

### ✅ **Step 1: Install Required Plugins**
- Install **Git**, **PHP**, and **Composer** on the Jenkins server.
- Install the **Pipeline Plugin** in Jenkins.

### ✅ **Step 2: Create a Jenkins Pipeline Job**
In `Jenkinsfile`:
```groovy
pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git branch: 'main', url: 'git@github.com:your-repo.git'
            }
        }
        
        stage('Install Dependencies') {
            steps {
                sh 'composer install --prefer-dist --no-progress --no-suggest'
            }
        }
        
        stage('Run Tests') {
            steps {
                sh 'php artisan test'
            }
        }
        
        stage('Deploy') {
            steps {
                sshagent(['your-ssh-key']) {
                    sh '''
                    ssh $SSH_USER@$SSH_HOST "cd /var/www/html && git pull origin main && composer install --no-dev --optimize-autoloader && php artisan migrate --force && php artisan config:cache && php artisan route:cache"
                    '''
                }
            }
        }
    }
}
```

---

## **6. Automated Deployment with Forge & Envoyer**

### ✅ **Laravel Forge**
- **Automates server setup** with Nginx, MySQL, Redis, and Supervisor.
- Provides **zero-downtime deployments**.
- Supports **automatic SSL (Let's Encrypt)**.

### ✅ **Laravel Envoyer**
- Offers **seamless zero-downtime deployment**.
- Can **rollback changes** if deployment fails.
- Works well with **GitHub, Bitbucket, and GitLab**.

---

## **7. CI/CD Best Practices for Laravel**
✅ **Keep `.env` out of version control** – use GitHub Secrets or `.env.production`.  
✅ **Use a separate database for testing** – Avoid modifying production data.  
✅ **Automate testing** – Use PestPHP or PHPUnit.  
✅ **Optimize Composer Autoloading** – `composer install --no-dev --optimize-autoloader`.  
✅ **Use rollback strategies** – Keep database backups for safe rollbacks.  
✅ **Monitor deployments** – Use tools like **New Relic** and **Sentry**.

---

## **8. Common Interview Questions on Laravel CI/CD**
1. What is CI/CD and why is it important for Laravel projects?
2. How do you automate deployment using GitHub Actions?
3. What are the steps to set up Laravel deployment with Jenkins?
4. How does Laravel Forge differ from Envoyer?
5. What is the best way to handle `.env` files in a CI/CD pipeline?
6. How do you perform zero-downtime deployments in Laravel?
7. What are some best practices for CI/CD in Laravel?

---


