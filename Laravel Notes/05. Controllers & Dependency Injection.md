# **5. Controllers & Dependency Injection**  

## **Controllers in Laravel**  
Controllers help organize business logic by keeping route files clean and separating request handling into dedicated classes.  

### **Creating a Controller**
Use the Artisan command to create a new controller:  
```sh
php artisan make:controller UserController
```
This generates `app/Http/Controllers/UserController.php`.  

### **Basic Controller Structure**
```php
namespace App\Http\Controllers;

use Illuminate\Http\Request;

class UserController extends Controller
{
    public function index()
    {
        return "List of users";
    }

    public function show($id)
    {
        return "User ID: " . $id;
    }
}
```

### **Using a Controller in Routes**
```php
use App\Http\Controllers\UserController;

Route::get('/users', [UserController::class, 'index']);
Route::get('/users/{id}', [UserController::class, 'show']);
```

---

## **Types of Controllers**  

### **1. Resource Controllers**
Laravel provides a resource controller to handle CRUD operations.  
```sh
php artisan make:controller ProductController --resource
```
This generates a controller with methods for common actions:  
```php
public function index() {}  // List all products
public function create() {} // Show form to create a new product
public function store(Request $request) {} // Store a new product
public function show($id) {} // Display a specific product
public function edit($id) {} // Show form to edit a product
public function update(Request $request, $id) {} // Update product
public function destroy($id) {} // Delete product
```
Register the resource controller in `routes/web.php`:  
```php
Route::resource('products', ProductController::class);
```

---

### **2. API Resource Controllers**
For APIs, exclude `create` and `edit` methods:  
```sh
php artisan make:controller API/ProductController --api
```
Use it in `routes/api.php`:  
```php
Route::apiResource('products', API\ProductController::class);
```

---

### **3. Single-Action Controllers**
Single-action controllers handle only **one method**.  
```sh
php artisan make:controller GenerateReport --invokable
```
The controller looks like this:  
```php
namespace App\Http\Controllers;

use Illuminate\Http\Request;

class GenerateReport extends Controller
{
    public function __invoke(Request $request)
    {
        return "Generating report...";
    }
}
```
Use it in routes without specifying a method:  
```php
Route::get('/report', GenerateReport::class);
```

---

## **Dependency Injection in Controllers**  

### **1. Constructor Injection**
Automatically inject dependencies when the controller is instantiated.  
```php
namespace App\Http\Controllers;

use App\Services\UserService;

class UserController extends Controller
{
    protected $userService;

    public function __construct(UserService $userService)
    {
        $this->userService = $userService;
    }

    public function index()
    {
        return $this->userService->getAllUsers();
    }
}
```
Laravel will resolve `UserService` automatically when the controller is called.  

---

### **2. Method Injection**
Inject dependencies into specific methods.  
```php
use Illuminate\Http\Request;

public function store(Request $request)
{
    $data = $request->all();
    return response()->json($data);
}
```

Injecting a model directly:  
```php
use App\Models\User;

public function show(User $user)
{
    return response()->json($user);
}
```
Here, Laravel automatically fetches the user by ID.

---

## **Controller Middleware**  
You can assign middleware inside a controller’s constructor.  
```php
public function __construct()
{
    $this->middleware('auth');
}
```
To apply middleware to specific methods:  
```php
public function __construct()
{
    $this->middleware('auth')->only(['edit', 'update']);
    $this->middleware('admin')->except(['index', 'show']);
}
```

---

## **Key Interview Questions on Controllers & Dependency Injection**  
1. What is a **controller** in Laravel? Why is it useful?  
2. What is the difference between **route closure and controller methods**?  
3. What is a **resource controller**? How do you generate and use one?  
4. How does **dependency injection** work in Laravel controllers?  
5. What is **constructor injection vs. method injection**?  
6. How does Laravel handle **route model binding** in controllers?  
7. What is an **invokable controller**, and when should you use one?  
8. How do you apply **middleware** inside a controller?  

---

### **1️⃣ What is a Controller in Laravel? Why is it useful?**  
#### ✅ **Answer:**  
A **controller** in Laravel is a PHP class that **manages HTTP requests and responses**. It helps organize logic by grouping related functions instead of defining them directly in route files.  

#### 🔹 **Example: Basic Controller (`UserController.php`)**  
```php
namespace App\Http\Controllers;

use Illuminate\Http\Request;

class UserController extends Controller
{
    public function show($id)
    {
        return "User ID: " . $id;
    }
}
```
#### 🔹 **How to Use in Routes (`web.php`)**  
```php
Route::get('/user/{id}', [UserController::class, 'show']);
```
✔ **Why use controllers?**  
- Keeps route files **clean**.  
- Groups related logic **efficiently**.  
- Supports **dependency injection**.  

---

### **2️⃣ What is the difference between route closure and controller methods?**  
#### ✅ **Answer:**  
| Feature | Route Closure | Controller Method |
|---------|--------------|-------------------|
| **Definition** | Defined inside `routes/web.php` | Defined inside a controller file |
| **Code Organization** | Not reusable | Reusable across multiple routes |
| **Dependency Injection** | Not possible | Possible |
| **Best for** | Small applications, quick prototypes | Large apps with structured logic |

#### 🔹 **Route Closure Example (`web.php`)**  
```php
Route::get('/welcome', function () {
    return "Hello, Laravel!";
});
```
✔ Good for **small logic**, but hard to maintain.  

#### 🔹 **Controller Method Example (`UserController.php`)**  
```php
class UserController extends Controller
{
    public function show($id)
    {
        return "User ID: " . $id;
    }
}
```
```php
Route::get('/user/{id}', [UserController::class, 'show']);
```
✔ Better for **large applications**.

---

### **3️⃣ What is a resource controller? How do you generate and use one?**  
#### ✅ **Answer:**  
A **resource controller** handles common CRUD (Create, Read, Update, Delete) operations automatically.  

#### 🔹 **Generate a Resource Controller:**  
```sh
php artisan make:controller ProductController --resource
```
✔ This creates `app/Http/Controllers/ProductController.php` with **7 pre-defined methods**:  
| Method | Purpose | HTTP Verb | Route |
|--------|---------|-----------|-------|
| `index()` | Show all records | GET | `/products` |
| `create()` | Show form to create new | GET | `/products/create` |
| `store()` | Save new record | POST | `/products` |
| `show($id)` | Show a single record | GET | `/products/{id}` |
| `edit($id)` | Show form to edit | GET | `/products/{id}/edit` |
| `update($id)` | Update record | PUT/PATCH | `/products/{id}` |
| `destroy($id)` | Delete record | DELETE | `/products/{id}` |

#### 🔹 **Registering a Resource Route in `web.php`**  
```php
Route::resource('products', ProductController::class);
```
✔ Laravel automatically generates routes for all **CRUD operations**.

---

### **4️⃣ How does dependency injection work in Laravel controllers?**  
#### ✅ **Answer:**  
Dependency injection in Laravel allows injecting **services, models, or repositories** into controllers.

#### 🔹 **Example: Injecting a Service into a Controller**  
```php
use App\Services\UserService;

class UserController extends Controller
{
    protected $userService;

    public function __construct(UserService $userService)
    {
        $this->userService = $userService;
    }

    public function index()
    {
        return $this->userService->getAllUsers();
    }
}
```
✔ Laravel automatically **resolves** the `UserService` and **injects** it into the controller.

---

### **5️⃣ What is constructor injection vs. method injection?**  
#### ✅ **Answer:**  
| Injection Type | Definition | Example |
|---------------|------------|---------|
| **Constructor Injection** | Injects dependencies in the constructor | `public function __construct(Service $service)` |
| **Method Injection** | Injects dependencies in a specific method | `public function show(Service $service)` |

#### 🔹 **Example of Constructor Injection:**  
```php
class OrderController extends Controller
{
    protected $orderService;

    public function __construct(OrderService $orderService)
    {
        $this->orderService = $orderService;
    }

    public function index()
    {
        return $this->orderService->getAllOrders();
    }
}
```

#### 🔹 **Example of Method Injection:**  
```php
class OrderController extends Controller
{
    public function show(OrderService $orderService, $id)
    {
        return $orderService->getOrderById($id);
    }
}
```
✔ **Use constructor injection** when a dependency is needed **throughout** the class.  
✔ **Use method injection** when a dependency is **specific to one function**.

---

### **6️⃣ How does Laravel handle route model binding in controllers?**  
#### ✅ **Answer:**  
Route Model Binding automatically **fetches a model instance** based on the route parameter.

#### 🔹 **Example: Implicit Route Model Binding**  
```php
Route::get('/users/{user}', [UserController::class, 'show']);
```
```php
class UserController extends Controller
{
    public function show(User $user)
    {
        return $user; // Laravel automatically fetches User model
    }
}
```
✔ No need to manually fetch the user using `User::find($id)`.  

#### 🔹 **Example: Explicit Route Model Binding (Custom Key)**  
```php
Route::get('/users/{username}', [UserController::class, 'show']);
```
```php
class RouteServiceProvider extends ServiceProvider
{
    public function boot()
    {
        Route::model('username', User::class);
    }
}
```
✔ Fetches the user by `username` instead of `id`.

---

### **7️⃣ What is an invokable controller, and when should you use one?**  
#### ✅ **Answer:**  
An **invokable controller** has a **single method** (`__invoke()`) and is used for **simple logic**.

#### 🔹 **Generating an Invokable Controller**  
```sh
php artisan make:controller ReportController --invokable
```
✔ Creates `ReportController.php` with a **single `__invoke()` method**.  

#### 🔹 **Example: `__invoke()` Method**  
```php
class ReportController extends Controller
{
    public function __invoke()
    {
        return "Generated Report";
    }
}
```
#### 🔹 **Defining the Route (`web.php`)**  
```php
Route::get('/report', ReportController::class);
```
✔ Best for **single-action controllers** (e.g., generating reports, sending emails).

---

### **8️⃣ How do you apply middleware inside a controller?**  
#### ✅ **Answer:**  
Middleware can be applied to controllers **inside the constructor** or **individual methods**.

#### 🔹 **Applying Middleware in the Constructor**  
```php
class DashboardController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth');
    }

    public function index()
    {
        return view('dashboard');
    }
}
```
✔ **All methods** in `DashboardController` require authentication.  

#### 🔹 **Applying Middleware to Specific Methods**  
```php
public function __construct()
{
    $this->middleware('auth')->only('profile');
    $this->middleware('guest')->except('login');
}
```
✔ `profile()` requires `auth`, but `login()` is accessible to guests.

---

### **Final Summary**
| Question | Key Takeaway |
|----------|-------------|
| **What is a Controller?** | Manages requests & responses, improves code organization. |
| **Route Closure vs. Controller?** | Closures for small apps, controllers for structured apps. |
| **What is a Resource Controller?** | A controller with pre-built CRUD methods. |
| **Dependency Injection?** | Services/models can be injected into controllers. |
| **Constructor vs. Method Injection?** | Constructor: class-wide, Method: function-specific. |
| **Route Model Binding?** | Automatically fetches models from route parameters. |
| **Invokable Controller?** | Used for single-action controllers. |
| **Middleware in Controllers?** | Applied via `__construct()` or per method. |

✔ Let me know if you need more details! 🚀