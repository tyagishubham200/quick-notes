# **21. Error Handling & Logging in Laravel**  

Laravel provides a powerful error handling and logging system out of the box. It integrates with Monolog to log errors and supports multiple log channels. Below, we cover the key aspects of **error handling and logging** in Laravel.  

---

## **1. Laravel's Default Error Handling**  
Laravel uses **`App\Exceptions\Handler`** to handle exceptions globally.  

### ✅ **Modify Global Exception Handling in `app/Exceptions/Handler.php`**  
```php
public function render($request, Throwable $exception)
{
    if ($exception instanceof ModelNotFoundException) {
        return response()->json(['error' => 'Record not found'], 404);
    }

    return parent::render($request, $exception);
}
```
- **`render()`**: Controls how exceptions are presented in the response.
- **`report()`**: Used to send errors to logging services (Sentry, Bugsnag, Slack, etc.).

---

## **2. Custom Exception Handling**  
Laravel allows creating custom exceptions for better error management.  

### ✅ **Create a Custom Exception**
```bash
php artisan make:exception CustomException
```
This generates `app/Exceptions/CustomException.php`.  

### ✅ **Define a Custom Exception**
```php
namespace App\Exceptions;

use Exception;

class CustomException extends Exception
{
    public function render()
    {
        return response()->json(['error' => $this->getMessage()], 400);
    }
}
```

### ✅ **Throw a Custom Exception**
```php
throw new \App\Exceptions\CustomException('Something went wrong');
```

---

## **3. Handling HTTP Exceptions**  
Laravel provides a helper for handling common HTTP exceptions.  

### ✅ **Abort Requests with Custom Messages**
```php
abort(403, 'Unauthorized action.');
abort(404); // Default Laravel 404 page
```

### ✅ **Handle 404 Errors in `Handler.php`**
```php
if ($exception instanceof NotFoundHttpException) {
    return response()->json(['message' => 'Resource not found'], 404);
}
```

---

## **4. Logging in Laravel**  
Laravel supports **single, daily, Slack, Syslog, and custom** log channels.  

### ✅ **Configure Logging in `.env`**
```ini
LOG_CHANNEL=daily
LOG_LEVEL=error
```
- **LOG_CHANNEL**: Defines the log type (`stack`, `single`, `daily`, `slack`, etc.).
- **LOG_LEVEL**: Controls which logs are recorded (`debug`, `info`, `warning`, `error`, etc.).

---

## **5. Logging to Files**  
### ✅ **Log Messages Using Laravel’s `Log` Facade**  
```php
use Illuminate\Support\Facades\Log;

Log::info('User logged in', ['user_id' => $user->id]);
Log::error('Database connection failed', ['error' => $exception->getMessage()]);
```

---

## **6. Logging to Slack**  
### ✅ **Enable Slack Logging in `config/logging.php`**
```php
'slack' => [
    'driver' => 'slack',
    'url' => env('LOG_SLACK_WEBHOOK_URL'),
    'username' => 'Laravel Log',
    'emoji' => ':boom:',
    'level' => 'error',
],
```
### ✅ **Set Webhook URL in `.env`**
```ini
LOG_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/your-webhook-url
```

---

## **7. Error Monitoring with Sentry/Bugsnag**  
Laravel supports **Sentry, Bugsnag, Rollbar** for monitoring errors.  

### ✅ **Install Sentry in Laravel**
```bash
composer require sentry/sentry-laravel
```
Add the Sentry DSN in `.env`:
```ini
SENTRY_LARAVEL_DSN=https://examplePublicKey@o0.ingest.sentry.io/0
```

---

## **8. Exception Logging in Jobs & Queues**  
Laravel allows logging exceptions in queued jobs.  

### ✅ **Handle Exceptions in Queued Jobs**
```php
public function handle()
{
    try {
        // Job logic
    } catch (\Exception $e) {
        Log::error('Job failed', ['error' => $e->getMessage()]);
    }
}
```

---

## **9. Custom Log Channels**  
Define custom log channels in `config/logging.php`.  

### ✅ **Example: Creating a Custom `database` Log Channel**
```php
'channels' => [
    'database' => [
        'driver' => 'single',
        'path' => storage_path('logs/database.log'),
        'level' => 'error',
    ],
],
```

### ✅ **Log Messages to the Custom Channel**
```php
Log::channel('database')->error('Database connection failed');
```

---

## **10. Recap of Error Handling & Logging Best Practices**  
✅ Use **custom exceptions** to handle errors more effectively.  
✅ Utilize **Laravel’s logging system** (`Log::info()`, `Log::error()`).  
✅ Configure **Slack notifications** for critical errors.  
✅ Use **Sentry/Bugsnag** for error tracking in production.  
✅ Handle **queued job exceptions** properly.  
✅ Use **custom log channels** for better debugging.  

---

## **11. Common Interview Questions on Error Handling & Logging**  
1. How does Laravel handle exceptions globally?  
2. What is the difference between `report()` and `render()` in `Handler.php`?  
3. How can you log errors to a file in Laravel?  
4. How can you send Laravel logs to Slack?  
5. What are custom exceptions, and how do you create them in Laravel?  
6. How do you handle logging in Laravel queues and jobs?  
7. What are different `LOG_CHANNEL` options available in Laravel?  
8. How do you integrate Laravel with Sentry or Bugsnag?  

---
